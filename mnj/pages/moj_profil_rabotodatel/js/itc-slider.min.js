/**
 * @class ItcSlider
 * @version 1.0.2
 * @author https://github.com/itchief
 * @copyright Alexander Maltsev 2020 - 2024
 * @license MIT (https://github.com/itchief/ui-components/blob/master/LICENSE)
 * @tutorial https://itchief.ru/javascript/slider
 */ class ItcSlider{static #a="wrapper";static #b="items";static #c="item";static #d="item-active";static #e="indicator";static #f="indicator-active";static #g="btn-prev";static #h="btn-next";static #i="btn-hide";static #j="transition-none";static #k=20;static #l=[];static checkSupportPassiveEvents(){let t=!1;try{let s=Object.defineProperty({},"passive",{get(){t=!0}});window.addEventListener("testPassiveListener",null,s),window.removeEventListener("testPassiveListener",null,s)}catch(e){t=!1}return t}#m;#n;#o;constructor(t,s={},e="itc-slider-"){this.#n={prefix:e,el:t,elWrapper:t.querySelector(`.${e}${this.constructor.#a}`),elItems:t.querySelector(`.${e}${this.constructor.#b}`),elListItem:t.querySelectorAll(`.${e}${this.constructor.#c}`),btnPrev:t.querySelector(`.${e}${this.constructor.#g}`),btnNext:t.querySelector(`.${e}${this.constructor.#h}`),btnClassHide:e+this.constructor.#i,exOrderMin:0,exOrderMax:0,exItemMin:null,exItemMax:null,exTranslateMin:0,exTranslateMax:0,direction:"next",intervalId:null,isSwiping:!1,swipeX:0,swipeY:0},this.#o=null,this.#m={loop:!0,direction:"next",autoplay:!1,interval:5e3,refresh:!0,swipe:!0,...s},this.#p(),this.#q()}static getInstance(t){let s=this.#l.find(s=>s.target===t);return s?s.instance:null}static getOrCreateInstance(t,s={},e="itc-slider-"){let i="string"==typeof t?document.querySelector(t):t,a=this.getInstance(i);if(a)return a;let n=new this(i,s,e);return this.#l.push({target:i,instance:n}),n}static createInstances(){document.querySelectorAll('[data-slider="itc-slider"]').forEach(t=>{let{dataset:s}=t,e={};Object.keys(s).forEach(t=>{if("slider"===t)return;let i=s[t];i="false"!==(i="true"===(i=Number.isNaN(Number(i))?i:Number(i))||i)&&i,e[t]=i}),this.getOrCreateInstance(t,e)})}slideNext(){this.#n.direction="next",this.#r()}slidePrev(){this.#n.direction="prev",this.#r()}slideTo(t){this.#s(t)}reset(){this.#t()}get autoplay(){return{start:()=>{this.#m.autoplay=!0,this.#u()},stop:()=>{this.#u("stop"),this.#m.autoplay=!1}}}dispose(){this.#v();let t=this.#n.prefix+this.constructor.#j,s=this.#n.prefix+this.constructor.#d;this.#u("stop"),this.#n.elItems.classList.add(t),this.#n.elItems.style.transform="",this.#n.elListItem.forEach(t=>{t.style.transform="",t.classList.remove(s)});let e=`${this.#n.prefix}${this.constructor.#f}`;document.querySelectorAll(`.${e}`).forEach(t=>{t.classList.remove(e)}),this.#n.elItems.offsetHeight,this.#n.elItems.classList.remove(t);let i=this.constructor.#l.findIndex(t=>t.target===this.#n.el);this.constructor.#l.splice(i,1)}#w(t){if(this.#n.isMoving&&t.preventDefault(),!(t.target.closest(".itc-slider-btn")||t.target.closest(".itc-slider-indicators")))return;let s=this.#n.prefix+this.constructor.#g,e=this.#n.prefix+this.constructor.#h;if(this.#u("stop"),t.target.closest(`.${s}`)||t.target.closest(`.${e}`))this.#n.direction=t.target.closest(`.${s}`)?"prev":"next",this.#r();else if(t.target.dataset.slideTo){let i=parseInt(t.target.dataset.slideTo,10);this.#s(i)}this.#m.loop&&this.#u()}#x(){this.#u("stop")}#y(){this.#u()}#z(){this.#m.loop&&!this.#n.isBalancing&&(this.#n.isBalancing=!0,window.requestAnimationFrame(()=>{this.#A(!1)}))}#B(){this.#m.loop&&(this.#n.isBalancing=!1)}#C(a){a.preventDefault()}#D(){"hidden"===document.visibilityState?this.#u("stop"):"visible"===document.visibilityState&&this.#m.loop&&this.#u()}#E(n){this.#n.isMoving=!1,this.#u("stop");let h=0===n.type.search("touch")?n.touches[0]:n;this.#n.swipeX=h.clientX,this.#n.swipeY=h.clientY,this.#n.isSwiping=!0,this.#n.isTouchMoving=!1}#F(r){if(!this.#n.isSwiping)return;let l=0===r.type.search("touch")?r.changedTouches[0]:r,o=this.#n.elWrapper.getBoundingClientRect(),c=l.clientX<o.left?o.left:l.clientX;c=c>o.right?o.right:c;let d=this.#n.swipeX-c;if(0===d){this.#n.isSwiping=!1;return}if(!this.#m.loop){let p=1===this.#n.activeItems[0]&&d<=0,u=this.#n.activeItems[this.#n.activeItems.length-1]&&d>=0;(p||u)&&(d=0)}let v=d/this.#n.width*100,m=this.#n.prefix+this.constructor.#j;if(this.#n.elItems.classList.remove(m),v>this.constructor.#k){this.#n.direction="next";let I=0;for(;I<=Math.floor(Math.abs(v)-this.constructor.#k)/100;)this.#r(),I+=1}else if(v<-this.constructor.#k){this.#n.direction="prev";let f=0;for(;f<=Math.floor(Math.abs(v)-this.constructor.#k)/100;)this.#r(),f+=1}else this.#n.direction="none",this.#r();this.#n.isSwiping=!1,this.#m.loop&&this.#u(),this.#n.isBalancing=!1}#G(g){if(!this.#n.isSwiping)return;this.#n.isMoving=!0;let x=0===g.type.search("touch")?g.changedTouches[0]:g,$=this.#n.swipeX-x.clientX,b=this.#n.swipeY-x.clientY,E=this.#n.prevPosX?this.#n.prevPosX:x.clientX,L=E>x.clientX?"next":"prev";if(this.#n.prevPosX=x.clientX,!this.#n.isTouchMoving){if(Math.abs(b)>Math.abs($)||0===Math.abs($)){this.#n.isSwiping=!1;return}this.#n.isTouchMoving=!0}if(g.preventDefault(),!this.#m.loop){let _=1===this.#n.activeItems[0]&&$<=0,y=this.#n.activeItems[this.#n.activeItems.length-1]&&$>=0;(_||y)&&($/=4)}let T=this.#n.prefix+this.constructor.#j;this.#n.elItems.classList.add(T);let w=this.#n.translate-$;this.#n.elItems.style.transform=`translate3D(${w}px, 0px, 0.1px)`,this.#m.loop&&(this.#n.direction=$>0?"next":"prev",this.#n.direction=L,window.requestAnimationFrame(()=>{this.#A(!0)}))}#q(){this.#n.events={click:[this.#n.el,this.#w.bind(this),!0],mouseenter:[this.#n.el,this.#x.bind(this),!0],mouseleave:[this.#n.el,this.#y.bind(this),!0],transitionstart:[this.#n.elItems,this.#z.bind(this),this.#m.loop],transitionend:[this.#n.elItems,this.#B.bind(this),this.#m.loop],touchstart:[this.#n.el,this.#E.bind(this),this.#m.swipe],mousedown:[this.#n.el,this.#E.bind(this),this.#m.swipe],touchend:[document,this.#F.bind(this),this.#m.swipe],mouseup:[document,this.#F.bind(this),this.#m.swipe],touchmove:[this.#n.el,this.#G.bind(this),this.#m.swipe],mousemove:[this.#n.el,this.#G.bind(this),this.#m.swipe],dragstart:[this.#n.el,this.#C.bind(this),!0],visibilitychange:[document,this.#D.bind(this),!0]},Object.keys(this.#n.events).forEach(t=>{if(this.#n.events[t][2]){let s=this.#n.events[t][0],e=this.#n.events[t][1];if("touchstart"===t||"touchmove"===t){let i=!!this.constructor.checkSupportPassiveEvents()&&{passive:!1};s.addEventListener(t,e,i)}else s.addEventListener(t,e)}}),this.#o=new ResizeObserver(t=>{window.requestAnimationFrame(this.#t.bind(this))}),this.#o.observe(this.#n.elWrapper)}#v(){Object.keys(this.#n.events).forEach(t=>{if(this.#n.events[t][2]){let s=this.#n.events[t][0],e=this.#n.events[t][1];s.removeEventListener(t,e),this.#o.disconnect()}})}#u(S){if(this.#m.autoplay){if("stop"===S){clearInterval(this.#n.intervalId),this.#n.intervalId=null;return}null===this.#n.intervalId&&(this.#n.intervalId=setInterval(()=>{this.#n.direction="prev"===this.#m.direction?"prev":"next",this.#r()},this.#m.interval))}}#A(M=!1){if(!this.#n.isBalancing&&!M)return;let N=this.#n.elWrapper.getBoundingClientRect(),C=N.width/this.#n.countActiveItems/2,O=this.#n.elListItem.length;if("next"===this.#n.direction){let P=this.#n.exItemMin.getBoundingClientRect().right;if(P<N.left-C){let A=this.#n.els.find(t=>t.el===this.#n.exItemMin);A.order=this.#n.exOrderMin+O;let R=this.#n.exTranslateMin+O*this.#n.width;A.translate=R,this.#n.exItemMin.style.transform=`translate3D(${R}px, 0px, 0.1px)`,this.#H()}}else{let D=this.#n.exItemMax.getBoundingClientRect().left;if(D>N.right+C){let H=this.#n.els.find(t=>t.el===this.#n.exItemMax);H.order=this.#n.exOrderMax-O;let B=this.#n.exTranslateMax-O*this.#n.width;H.translate=B,this.#n.exItemMax.style.transform=`translate3D(${B}px, 0px, 0.1px)`,this.#H()}}M||window.requestAnimationFrame(()=>{this.#A(!1)})}#I(){let X=this.#n.prefix+this.constructor.#d;this.#n.activeItems.forEach((t,s)=>{t?this.#n.elListItem[s].classList.add(X):this.#n.elListItem[s].classList.remove(X);let e=this.#n.el.querySelectorAll(`.${this.#n.prefix}${this.constructor.#e}`);e.length&&t?e[s].classList.add(`${this.#n.prefix}${this.constructor.#f}`):e.length&&!t&&e[s].classList.remove(`${this.#n.prefix}${this.constructor.#f}`)})}#r(){if("none"===this.#n.direction){let q=this.#n.translate;this.#n.elItems.style.transform=`translate3D(${q}px, 0px, 0.1px)`;return}let W="next"===this.#n.direction?-this.#n.width:this.#n.width,V=this.#n.translate+W;if(!this.#m.loop){let k=this.#n.width*(this.#n.elListItem.length-this.#n.countActiveItems);if(Math.round(100*V)<-Math.round(100*k)||Math.round(100*V)>0)return;this.#n.btnPrev&&(this.#n.btnPrev.classList.remove(this.#n.btnClassHide),this.#n.btnNext.classList.remove(this.#n.btnClassHide)),this.#n.btnPrev&&Math.round(100*V)===-Math.round(100*k)?this.#n.btnNext.classList.add(this.#n.btnClassHide):this.#n.btnPrev&&0===Math.round(100*V)&&this.#n.btnPrev.classList.add(this.#n.btnClassHide)}"next"===this.#n.direction?this.#n.activeItems=[...this.#n.activeItems.slice(-1),...this.#n.activeItems.slice(0,-1)]:this.#n.activeItems=[...this.#n.activeItems.slice(1),...this.#n.activeItems.slice(0,1)],this.#I(),this.#n.translate=V,this.#n.elItems.style.transform=`translate3D(${V}px, 0px, 0.1px)`}#s(F){let Y=this.#n.activeItems.reduce((t,s,e)=>{let i=s?F-e:t;return Math.abs(i)<Math.abs(t)?i:t},this.#n.activeItems.length);if(0!==Y){this.#n.direction=Y>0?"next":"prev";for(let z=0;z<Math.abs(Y);z++)this.#r()}}#p(){this.#n.els=[],this.#n.translate=0,this.#n.activeItems=[],this.#n.isBalancing=!1;let j=parseFloat(getComputedStyle(this.#n.elItems).gap)||0;this.#n.width=this.#n.elListItem[0].getBoundingClientRect().width+j;let G=this.#n.elWrapper.getBoundingClientRect().width;if(this.#n.countActiveItems=Math.round(G/this.#n.width),this.#n.elListItem.forEach((t,s)=>{t.style.transform="",this.#n.activeItems.push(s<this.#n.countActiveItems?1:0),this.#n.els.push({el:t,index:s,order:s,translate:0})}),this.#n.countActiveItems===this.#n.elListItem.length?(this.#n.btnPrev&&this.#n.btnPrev.classList.add(this.#n.btnClassHide),this.#n.btnNext&&this.#n.btnNext.classList.add(this.#n.btnClassHide)):(this.#n.btnPrev&&this.#n.btnPrev.classList.remove(this.#n.btnClassHide),this.#n.btnNext&&this.#n.btnNext.classList.remove(this.#n.btnClassHide)),this.#m.loop){let J=this.#n.elListItem.length-1,K=-(J+1)*this.#n.width;this.#n.elListItem[J].style.transform=`translate3D(${K}px, 0px, 0.1px)`,this.#n.els[J].order=-1,this.#n.els[J].translate=K,this.#H()}else this.#n.btnPrev&&this.#n.btnPrev.classList.add(this.#n.btnClassHide);this.#I(),this.#u()}#t(){let Q=this.#n.prefix+this.constructor.#j,U=parseFloat(getComputedStyle(this.#n.elItems).gap)||0,Z=this.#n.elListItem[0].getBoundingClientRect().width+U,tt=this.#n.elWrapper.getBoundingClientRect().width;(Z!==this.#n.width||Math.round(tt/Z)!==this.#n.countActiveItems)&&(this.#u("stop"),this.#n.elItems.classList.add(Q),this.#n.elItems.style.transform="translate3D(0px, 0px, 0.1px)",this.#p(),window.requestAnimationFrame(()=>{this.#n.elItems.classList.remove(Q)}))}#H(){let ts=this.#n.els.map(t=>t.el),te=this.#n.els.map(t=>t.order);this.#n.exOrderMin=Math.min(...te),this.#n.exOrderMax=Math.max(...te);let ti=te.indexOf(this.#n.exOrderMin),ta=te.indexOf(this.#n.exOrderMax);this.#n.exItemMin=ts[ti],this.#n.exItemMax=ts[ta],this.#n.exTranslateMin=this.#n.els[ti].translate,this.#n.exTranslateMax=this.#n.els[ta].translate}}ItcSlider.createInstances();